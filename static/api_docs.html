<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>API æ–‡æ¡£ - æ™´è¾°äº‘é‚®</title>
    <link href="/dashboard/css/tailwind.min.css?v=8.0" rel="stylesheet">
    <script src="/dashboard/js/loader.js?v=8.0"></script>
    <script src="/dashboard/js/common.js?v=8.0"></script>
    <script src="/dashboard/js/layout.js?v=8.0"></script>
    <style>
        .code-block { font-family: 'Fira Code', monospace; font-size: 0.9em; background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; }
        .token { color: #ce9178; }
        .key { color: #9cdcfe; }
        .keyword { color: #569cd6; }
    </style>
</head>
<body class="hidden" data-i18n-module="api_docs">
    <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-800" data-i18n="api.title">API æ¥å£æ–‡æ¡£</h2>
        <p class="text-gray-500 mt-1" data-i18n="api.subtitle">é€šè¿‡ HTTP RESTful API é›†æˆé‚®ä»¶å‘é€åŠŸèƒ½</p>
    </div>

    <div class="space-y-8 w-full">
        
        <!-- AI æ¥å…¥æç¤ºè¯ -->
        <div class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl shadow-sm border border-purple-100 p-8">
            <h3 class="text-xl font-bold text-purple-900 mb-4 flex items-center">
                <span class="bg-purple-100 text-purple-600 p-1.5 rounded-lg mr-3">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                </span>
                <span data-i18n="api.ai.title">ğŸ¤– AI æ¥å…¥æç¤ºè¯ (Prompt)</span>
            </h3>
            <p class="text-purple-700 mb-4 text-sm" data-i18n="api.ai.desc">
                å°†ä»¥ä¸‹æç¤ºè¯å¤åˆ¶ç»™ ChatGPTã€Claude æˆ– Cursorï¼Œè®© AI å¸®æ‚¨å¿«é€Ÿç¼–å†™å¯¹æ¥ä»£ç ã€‚
            </p>
            <div class="bg-white rounded-lg border border-purple-200 p-4 relative group">
                <button onclick="copyPrompt()" class="absolute top-2 right-2 bg-purple-100 text-purple-600 px-3 py-1 rounded text-xs font-bold hover:bg-purple-200 transition" data-i18n="api.ai.copy_btn">å¤åˆ¶æç¤ºè¯</button>
                <!-- å†…å®¹å°†ç”± JS åŠ¨æ€æ¸²æŸ“ -->
                <pre class="text-xs text-gray-600 whitespace-pre-wrap font-mono" id="ai-prompt">Loading...</pre>
            </div>
            <p class="text-xs text-gray-400 mt-2 ml-1" data-i18n="api.ai.usage">ğŸ’¡ ä½¿ç”¨æ–¹æ³•ï¼šå¤åˆ¶ä¸Šæ–¹å†…å®¹å‘é€ç»™ ChatGPT/Claudeï¼Œå¹¶å°† <code>[Python/Java...]</code> æ›¿æ¢ä¸ºæ‚¨ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ã€‚</p>
        </div>

        <!-- è®¤è¯éƒ¨åˆ† -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
            <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                <span class="bg-blue-100 text-blue-600 p-1.5 rounded-lg mr-3">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path></svg>
                </span>
                <span data-i18n="api.auth.title">é‰´æƒè®¤è¯</span>
            </h3>
            <p class="text-gray-600 mb-4" data-i18n="api.auth.desc">
                è¯·å‰å¾€ <strong><a href="/dashboard/keys.html" class="text-blue-600 hover:underline">å¯†é’¥ç®¡ç†</a></strong> é¡µé¢ç”Ÿæˆæ°¸ä¹… API Key (ä»¥ <code>sk_live_</code> å¼€å¤´)ã€‚
                <br>æ‰€æœ‰ API è¯·æ±‚å¿…é¡»åœ¨ HTTP Header ä¸­åŒ…å«ï¼š
            </p>
            <div class="code-block mb-4">
                Authorization: Bearer <span class="token">sk_live_xxxxxxxxxxxxxxxxxxxxxxxx</span>
            </div>
        </div>

        <!-- å‘é€æ¥å£ -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-900 flex items-center">
                    <span class="bg-green-100 text-green-600 p-1.5 rounded-lg mr-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                    </span>
                    <span data-i18n="api.send.title">å‘é€é‚®ä»¶æ¥å£</span>
                </h3>
                <span class="bg-blue-100 text-blue-800 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide">POST</span>
            </div>
            
            <div class="mb-6">
                <p class="font-mono text-sm bg-gray-100 p-3 rounded border border-gray-200 text-gray-700">
                    /api/v1/send
                </p>
            </div>

            <h4 class="font-bold text-gray-800 mb-3 text-sm uppercase tracking-wider" data-i18n="api.send.params_title">è¯·æ±‚å‚æ•° (JSON)</h4>
            <div class="overflow-x-auto mb-6">
                <table class="w-full text-sm text-left text-gray-600 border rounded-lg">
                    <thead class="bg-gray-50 text-gray-700 font-bold">
                        <tr>
                            <th class="px-4 py-2 border-b" data-i18n="api.table.field">å­—æ®µ</th>
                            <th class="px-4 py-2 border-b" data-i18n="api.table.type">ç±»å‹</th>
                            <th class="px-4 py-2 border-b" data-i18n="api.table.required">å¿…å¡«</th>
                            <th class="px-4 py-2 border-b" data-i18n="api.table.desc">è¯´æ˜</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        <tr>
                            <td class="px-4 py-2 font-mono text-blue-600">to</td>
                            <td class="px-4 py-2">String</td>
                            <td class="px-4 py-2 text-red-500" data-i18n="api.req.yes">æ˜¯</td>
                            <td class="px-4 py-2" data-i18n="api.param.to">æ”¶ä»¶äººé‚®ç®±åœ°å€</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-2 font-mono text-blue-600">subject</td>
                            <td class="px-4 py-2">String</td>
                            <td class="px-4 py-2 text-red-500" data-i18n="api.req.cond">æ¡ä»¶</td>
                            <td class="px-4 py-2" data-i18n="api.param.subject">é‚®ä»¶ä¸»é¢˜</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-2 font-mono text-blue-600">body</td>
                            <td class="px-4 py-2">String</td>
                            <td class="px-4 py-2 text-red-500" data-i18n="api.req.cond">æ¡ä»¶</td>
                            <td class="px-4 py-2" data-i18n="api.param.body">é‚®ä»¶æ­£æ–‡ã€‚è‹¥æœªæä¾› <code>template_id</code> åˆ™å¿…å¡«ã€‚</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-2 font-mono text-blue-600">template_id</td>
                            <td class="px-4 py-2">Integer</td>
                            <td class="px-4 py-2 text-gray-400" data-i18n="api.req.no">å¦</td>
                            <td class="px-4 py-2" data-i18n="api.param.template_id">ä½¿ç”¨é¢„è®¾æ¨¡æ¿ IDã€‚è‹¥æä¾›ï¼Œä¼šè‡ªåŠ¨è¦†ç›– subject/bodyï¼Œå¹¶æ”¯æŒå˜é‡æ›¿æ¢ã€‚</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-2 font-mono text-blue-600">variables</td>
                            <td class="px-4 py-2">Object</td>
                            <td class="px-4 py-2 text-gray-400" data-i18n="api.req.no">å¦</td>
                            <td class="px-4 py-2" data-i18n="api.param.variables">æ¨¡æ¿å˜é‡ (é”®å€¼å¯¹)ã€‚ä¾‹å¦‚: <code>{"name": "å¼ ä¸‰"}</code> å¯æ›¿æ¢æ¨¡æ¿ä¸­çš„ <code>{{.name}}</code></td>
                        </tr>
                        <tr>
                            <td class="px-4 py-2 font-mono text-blue-600">from</td>
                            <td class="px-4 py-2">String</td>
                            <td class="px-4 py-2 text-gray-400" data-i18n="api.req.no">å¦</td>
                            <td class="px-4 py-2" data-i18n="api.param.from">å‘ä»¶äººåœ°å€ (ä¸å¡«åˆ™ä½¿ç”¨ç³»ç»Ÿé»˜è®¤)</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-2 font-mono text-blue-600">channel_id</td>
                            <td class="px-4 py-2">Integer</td>
                            <td class="px-4 py-2 text-gray-400" data-i18n="api.req.no">å¦</td>
                            <td class="px-4 py-2" data-i18n="api.param.channel_id">æŒ‡å®šå‘é€é€šé“ ID (0 æˆ–ä¸å¡«ä¸ºè‡ªåŠ¨/Direct, >0 ä¸ºæŒ‡å®š SMTP é…ç½® ID)</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-2 font-mono text-blue-600">attachments</td>
                            <td class="px-4 py-2">Array</td>
                            <td class="px-4 py-2 text-gray-400" data-i18n="api.req.no">å¦</td>
                            <td class="px-4 py-2" data-i18n="api.param.attachments">é™„ä»¶åˆ—è¡¨ã€‚æ”¯æŒ <code>content</code> (Base64) æˆ– <code>url</code> (è¿œç¨‹åœ°å€)ã€‚</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4 class="font-bold text-gray-800 mb-3 text-sm uppercase tracking-wider" data-i18n="api.example.curl_title">è°ƒç”¨ç¤ºä¾‹ (cURL)</h4>
            <div class="code-block mb-6">
# ç¤ºä¾‹ 1: ç›´æ¥å‘é€ HTML å†…å®¹
curl -X POST <span id="curl-url">http://localhost:9901/api/v1/send</span> \
  -H "Authorization: Bearer <span class="token">sk_live_...</span>" \
  -H "Content-Type: application/json" \
  -d '{
    <span class="key">"to"</span>: "user@example.com",
    <span class="key">"subject"</span>: "æ¬¢è¿æ³¨å†Œæ™´è¾°äº‘é‚®",
    <span class="key">"body"</span>: "<h1>ä½ å¥½ï¼</h1><p>è¿™æ˜¯ä¸€å°æµ‹è¯•é‚®ä»¶ã€‚</p>"
  }'

# ç¤ºä¾‹ 2: ä½¿ç”¨æ¨¡æ¿ + å˜é‡
curl -X POST <span id="curl-url-tpl">http://localhost:9901/api/v1/send</span> \
  -H "Authorization: Bearer <span class="token">sk_live_...</span>" \
  -H "Content-Type: application/json" \
  -d '{
    <span class="key">"to"</span>: "user@example.com",
    <span class="key">"template_id"</span>: 1,
    <span class="key">"variables"</span>: {
       "name": "å¼ ä¸‰",
       "code": "8848"
    }
  }'

# ç¤ºä¾‹ 3: å‘é€è¿œç¨‹é™„ä»¶
curl -X POST <span id="curl-url-att">http://localhost:9901/api/v1/send</span> \
  -H "Authorization: Bearer <span class="token">sk_live_...</span>" \
  -H "Content-Type: application/json" \
  -d '{
    <span class="key">"to"</span>: "user@example.com",
    <span class="key">"subject"</span>: "å‘ç¥¨æ–‡ä»¶",
    <span class="key">"body"</span>: "è¯·æŸ¥æ”¶é™„ä»¶ã€‚",
    <span class="key">"attachments"</span>: [
       {
         "filename": "invoice_2024.pdf",
         "url": "https://oss.example.com/download/inv_123.pdf",
         "content_type": "application/pdf"
       }
    ]
  }'
            </div>

            <h4 class="font-bold text-gray-800 mb-3 text-sm uppercase tracking-wider" data-i18n="api.example.resp_async">å“åº”ç¤ºä¾‹ (å¼‚æ­¥å…¥é˜ŸæˆåŠŸ - HTTP 202)</h4>
            <div class="code-block mb-6">
{
  <span class="key">"message"</span>: <span class="token">"Email queued successfully"</span>,
  <span class="key">"queue_id"</span>: 1024
}
            </div>

            <h4 class="font-bold text-gray-800 mb-3 text-sm uppercase tracking-wider" data-i18n="api.example.resp_error_title">é”™è¯¯å“åº”æ ¼å¼</h4>
            <div class="code-block mb-6">
<span class="keyword">// HTTP 400 - è¯·æ±‚å‚æ•°é”™è¯¯</span>
{ <span class="key">"error"</span>: <span class="token">"Template not found"</span> }

<span class="keyword">// HTTP 401 - è®¤è¯å¤±è´¥</span>
{ <span class="key">"error"</span>: <span class="token">"Invalid token or API key"</span> }

<span class="keyword">// HTTP 403 - æƒé™ä¸è¶³</span>
{ <span class="key">"error"</span>: <span class="token">"API Key does not have permission to access this endpoint"</span> }

<span class="keyword">// HTTP 429 - é¢‘ç‡è¶…é™</span>
{ <span class="key">"error"</span>: <span class="token">"Too many requests, please try again later"</span> }

<span class="keyword">// HTTP 500 - æœåŠ¡å™¨é”™è¯¯</span>
{ <span class="key">"error"</span>: <span class="token">"Failed to queue email: ..."</span> }
            </div>

            <h4 class="font-bold text-gray-800 mb-3 text-sm uppercase tracking-wider" data-i18n="api.example.status_codes_title">HTTP çŠ¶æ€ç è¯´æ˜</h4>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-600 border rounded-lg">
                    <thead class="bg-gray-50 text-gray-700 font-bold">
                        <tr>
                            <th class="px-4 py-2 border-b">çŠ¶æ€ç </th>
                            <th class="px-4 py-2 border-b">å«ä¹‰</th>
                            <th class="px-4 py-2 border-b">å¤„ç†å»ºè®®</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        <tr>
                            <td class="px-4 py-2"><span class="bg-green-100 text-green-800 px-2 py-0.5 rounded font-mono text-xs">202</span></td>
                            <td class="px-4 py-2">é‚®ä»¶å·²åŠ å…¥å‘é€é˜Ÿåˆ—</td>
                            <td class="px-4 py-2 text-gray-400">æˆåŠŸï¼Œæ— éœ€å¤„ç†</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-2"><span class="bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded font-mono text-xs">400</span></td>
                            <td class="px-4 py-2">è¯·æ±‚å‚æ•°é”™è¯¯</td>
                            <td class="px-4 py-2 text-gray-400">æ£€æŸ¥å¿…å¡«å­—æ®µå’Œæ ¼å¼</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-2"><span class="bg-red-100 text-red-800 px-2 py-0.5 rounded font-mono text-xs">401</span></td>
                            <td class="px-4 py-2">è®¤è¯å¤±è´¥</td>
                            <td class="px-4 py-2 text-gray-400">æ£€æŸ¥ API Key æˆ– Token æ˜¯å¦æœ‰æ•ˆ</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-2"><span class="bg-red-100 text-red-800 px-2 py-0.5 rounded font-mono text-xs">403</span></td>
                            <td class="px-4 py-2">æƒé™ä¸è¶³</td>
                            <td class="px-4 py-2 text-gray-400">API Key ä»…æ”¯æŒ /sendã€/statsã€/files æ¥å£</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-2"><span class="bg-orange-100 text-orange-800 px-2 py-0.5 rounded font-mono text-xs">429</span></td>
                            <td class="px-4 py-2">è¯·æ±‚é¢‘ç‡è¶…é™</td>
                            <td class="px-4 py-2 text-gray-400">å®ç°æŒ‡æ•°é€€é¿é‡è¯• (å»ºè®®æœ€å¤§é—´éš” 60s)</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-2"><span class="bg-gray-100 text-gray-800 px-2 py-0.5 rounded font-mono text-xs">500</span></td>
                            <td class="px-4 py-2">æœåŠ¡å™¨å†…éƒ¨é”™è¯¯</td>
                            <td class="px-4 py-2 text-gray-400">ç¨åé‡è¯•ï¼ŒæŒç»­å‡ºç°è¯·è”ç³»ç®¡ç†å‘˜</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- è”ç³»äººç®¡ç† -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
            <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                <span class="bg-purple-100 text-purple-600 p-1.5 rounded-lg mr-3">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                </span>
                <span data-i18n="api.contacts.title">è”ç³»äººç®¡ç†</span>
            </h3>
            
            <div class="space-y-6">
                <div>
                    <h4 class="font-bold text-gray-700 text-sm mb-2">æ·»åŠ è”ç³»äºº</h4>
                    <p class="font-mono text-sm bg-gray-100 p-2 rounded mb-2">POST /api/v1/contacts</p>
                    <div class="code-block">
{
  <span class="key">"email"</span>: "user@example.com",
  <span class="key">"name"</span>: "å¼ ä¸‰",
  <span class="key">"group_id"</span>: 1
}
                    </div>
                </div>
                
                <div>
                    <h4 class="font-bold text-gray-700 text-sm mb-2">æ‰¹é‡å¯¼å…¥</h4>
                    <p class="font-mono text-sm bg-gray-100 p-2 rounded mb-2">POST /api/v1/contacts/import</p>
                    <div class="code-block">
{
  <span class="key">"group_id"</span>: 1,
  <span class="key">"data"</span>: "u1@test.com,User1\nu2@test.com,User2"
}
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¨¡æ¿æŸ¥è¯¢æ¥å£ -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-900 flex items-center">
                    <span class="bg-indigo-100 text-indigo-600 p-1.5 rounded-lg mr-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    </span>
                    <span data-i18n="api.tpl.title">æŸ¥è¯¢æ¨¡æ¿åˆ—è¡¨</span>
                </h3>
                <span class="bg-green-100 text-green-800 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide">GET</span>
            </div>
            
            <div class="mb-6">
                <p class="font-mono text-sm bg-gray-100 p-3 rounded border border-gray-200 text-gray-700">
                    /api/v1/templates
                </p>
            </div>

            <h4 class="font-bold text-gray-800 mb-3 text-sm uppercase tracking-wider" data-i18n="api.example.resp_json">å“åº”ç¤ºä¾‹ (JSON)</h4>
            <div class="code-block">
[
  {
    <span class="key">"id"</span>: 1,
    <span class="key">"name"</span>: "æ³¨å†ŒéªŒè¯ç ",
    <span class="key">"subject"</span>: "æ¬¢è¿æ³¨å†Œ - éªŒè¯ç  {{.code}}",
    <span class="key">"body"</span>: "<h1>æ‚¨çš„éªŒè¯ç æ˜¯ {{.code}}</h1>..."
  },
  {
    <span class="key">"id"</span>: 2,
    <span class="key">"name"</span>: "å¯†ç é‡ç½®",
    <span class="key">"subject"</span>: "é‡ç½®æ‚¨çš„å¯†ç ",
    <span class="key">"body"</span>: "..."
  }
]
            </div>
        </div>

    </div>

    <script>
        Auth.check();
        
        const baseUrl = window.location.origin + '/api/v1';

        function renderPrompt() {
            // è·å–ç¿»è¯‘åçš„æ¨¡æ¿å¹¶æ›¿æ¢ Base URL
            if (typeof I18n !== 'undefined' && I18n.isReady) {
                const template = I18n.t('api.ai.prompt_template');
                const prompt = template.replace('{base_url}', baseUrl);
                document.getElementById('ai-prompt').innerText = prompt;
            }
        }
        
        document.getElementById('curl-url').innerText = baseUrl + '/send';

        function copyPrompt() {
            const text = document.getElementById('ai-prompt').innerText;
            navigator.clipboard.writeText(text).then(() => {
                showToast(I18n.t('api.toast.copied'));
            });
        }

        // ç­‰å¾… I18n åŠ è½½å®Œæˆåæ¸²æŸ“ Prompt
        if (typeof I18n !== 'undefined' && I18n.isReady) {
            renderPrompt();
        } else {
            document.addEventListener('i18n-ready', renderPrompt);
        }
    </script>
</body>
</html>
